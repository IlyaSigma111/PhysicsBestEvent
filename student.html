<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üì° –û–ø—Ç–æ–≤–æ–ª–æ–∫–Ω–æ ¬∑ 30 –∑–∞–¥–∞–Ω–∏–π</title>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º MEGA GLASS —Å—Ç–∏–ª–∏ -->
    <link rel="stylesheet" href="style.css">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body>
    <!-- –õ–µ—Ç–∞—é—â–∏–µ —Ñ–æ—Ç–æ–Ω—ã (–±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS) -->
    <div id="photons"></div>
    
    <div class="glass-card">
        <!-- –≠–ö–†–ê–ù 1: –í–•–û–î -->
        <div id="screenLobby" class="screen">
            <h1>üì° FIBER OPTIC</h1>
            <div class="subtitle">30 –∑–∞–¥–∞–Ω–∏–π ¬∑ –ü–í–û</div>
            
            <input type="text" id="playerName" class="input" placeholder="–¢–≤–æ—ë –∏–º—è" maxlength="15">
            <input type="text" id="gameCode" class="input" placeholder="–ö–æ–¥ —Ç–µ—Å—Ç–∞ (6 —Ü–∏—Ñ—Ä)" maxlength="6">
            
            <button class="btn primary" onclick="joinGame()">üîÆ –í–æ–π—Ç–∏</button>
            <div id="errorMsg" class="text-center" style="color: #ff6b6b; margin-top: 10px; font-size: 0.8rem;"></div>
        </div>

        <!-- –≠–ö–†–ê–ù 2: –û–ñ–ò–î–ê–ù–ò–ï -->
        <div id="screenWait" class="screen hidden">
            <h1>‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ</h1>
            <div class="code-big" id="displayCode" style="font-size: 4rem; font-family: monospace; text-align: center; margin: 20px 0; letter-spacing: 10px;">000000</div>
            <div class="text-center" id="playersCount">0 –∏–≥—Ä–æ–∫–æ–≤</div>
            <div class="text-center" style="margin-top: 20px; opacity: 0.8;">–£—á–∏—Ç–µ–ª—å –Ω–∞—á–Ω—ë—Ç —Ç–µ—Å—Ç</div>
        </div>

        <!-- –≠–ö–†–ê–ù 3: –¢–ï–°–¢ -->
        <div id="screenGame" class="screen hidden">
            <!-- –®–∞–ø–∫–∞ -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                <span style="color: white; font-size: 1rem;" id="displayName"></span>
                <span class="timer" id="displayTimer">15:00</span>
            </div>

            <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å -->
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <!-- –°—á—ë—Ç—á–∏–∫ -->
            <div class="counter">
                <span id="answeredCount">0/30</span>
                <span>üßÆ —Ä–∞—Å—á—ë—Ç–Ω—ã–µ</span>
            </div>

            <!-- –°–µ—Ç–∫–∞ 6x5 -->
            <div class="grid" id="questionsGrid"></div>

            <!-- –¢–µ–∫—É—â–∏–π –≤–æ–ø—Ä–æ—Å -->
            <div class="question-box" id="questionBox">
                <div class="question-text" id="questionText"></div>
                
                <!-- –ë–ª–æ–∫ –¥–ª—è —Ä–∞—Å—á—ë—Ç–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π -->
                <div id="calcNote" class="calc-note hidden">
                    <span style="font-weight: bold;">üßÆ –†–∞—Å—á—ë—Ç–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ</span><br>
                    –°–¥–µ–ª–∞–π —Ä–∞—Å—á—ë—Ç –≤ —Ç–µ—Ç—Ä–∞–¥–∏, –∑–∞—Ç–µ–º –≤—ã–±–µ—Ä–∏ –æ—Ç–≤–µ—Ç
                </div>
                
                <!-- –§–æ—Ä–º—É–ª–∞ (–¥–ª—è —Ä–∞—Å—á—ë—Ç–Ω—ã—Ö) -->
                <div id="formulaDisplay" class="hidden"></div>
                
                <!-- –í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ -->
                <div class="options" id="optionsContainer"></div>
            </div>

            <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
            <div class="nav">
                <div class="nav-btn" onclick="prevQuestion()" id="prevBtn">‚Üê –ù–∞–∑–∞–¥</div>
                <div class="nav-btn primary" onclick="nextQuestion()" id="nextBtn">–î–∞–ª–µ–µ ‚Üí</div>
                <div class="nav-btn danger" onclick="submitTest()">üì® –û—Ç–ø—Ä</div>
            </div>
        </div>

        <!-- –≠–ö–†–ê–ù 4: –†–ï–ó–£–õ–¨–¢–ê–¢ -->
        <div id="screenResult" class="screen hidden">
            <h1>üèÜ –†–µ–∑—É–ª—å—Ç–∞—Ç</h1>
            <div style="font-size: 4rem; text-align: center; margin: 30px 0;" id="finalScore">0</div>
            <div class="text-center" id="finalMessage"></div>
            <div style="margin-top: 30px;">
                <button class="btn" onclick="exit()">–í—ã–π—Ç–∏</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // FIREBASE –ö–û–ù–§–ò–ì (–∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ —Ñ–∞–π–ª–∞ –∏–ª–∏ —Ç—É—Ç)
        // ============================================
        const firebaseConfig = {
            apiKey: "AIzaSyC_86gSXMHhRXk3q63usfJK3fQrFhQU7Ig",
            authDomain: "physicsproject-b5660.firebaseapp.com",
            databaseURL: "https://physicsproject-b5660-default-rtdb.firebaseio.com",
            projectId: "physicsproject-b5660",
            storageBucket: "physicsproject-b5660.firebasestorage.app",
            messagingSenderId: "244631414073",
            appId: "1:244631414073:web:69b4bdc74e233051f474e8"
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // ============================================
        // 30 –ó–ê–î–ê–ù–ò–ô (25 —Ç–µ—Å—Ç–æ–≤—ã—Ö + 5 —Ä–∞—Å—á—ë—Ç–Ω—ã—Ö)
        // ============================================
        const QUESTIONS = [
            // 1-5: –û—Å–Ω–æ–≤—ã –ü–í–û
            {
                id: 1,
                text: "–ß—Ç–æ —Ç–∞–∫–æ–µ –ø–æ–ª–Ω–æ–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ?",
                options: [
                    "–û—Ç—Ä–∞–∂–µ–Ω–∏–µ —Å–≤–µ—Ç–∞ –æ—Ç –∑–µ—Ä–∫–∞–ª–∞",
                    "–û—Ç—Ä–∞–∂–µ–Ω–∏–µ –±–µ–∑ –≤—ã—Ö–æ–¥–∞ –≤ –¥—Ä—É–≥—É—é —Å—Ä–µ–¥—É",
                    "–ü—Ä–µ–ª–æ–º–ª–µ–Ω–∏–µ –ø–æ–¥ –ø—Ä—è–º—ã–º —É–≥–ª–æ–º",
                    "–ü–æ–≥–ª–æ—â–µ–Ω–∏–µ —Å–≤–µ—Ç–∞"
                ],
                correct: 1,
                isCalc: false
            },
            {
                id: 2,
                text: "–ü—Ä–∏ –∫–∞–∫–æ–º —É—Å–ª–æ–≤–∏–∏ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –ü–í–û?",
                options: [
                    "n1 < n2, —É–≥–æ–ª –ª—é–±–æ–π",
                    "n1 > n2, —É–≥–æ–ª > –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ",
                    "n1 = n2",
                    "–≤ –≤–∞–∫—É—É–º–µ"
                ],
                correct: 1,
                isCalc: false
            },
            {
                id: 3,
                text: "–ß—Ç–æ —Ç–∞–∫–æ–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É–≥–æ–ª?",
                options: [
                    "–£–≥–æ–ª, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º —Å–≤–µ—Ç –≥–∞—Å–Ω–µ—Ç",
                    "–£–≥–æ–ª, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ü–í–û",
                    "–£–≥–æ–ª –ø–æ–ª–Ω–æ–π –ø–æ–ª—è—Ä–∏–∑–∞—Ü–∏–∏",
                    "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É–≥–æ–ª –ø—Ä–µ–ª–æ–º–ª–µ–Ω–∏—è"
                ],
                correct: 1,
                isCalc: false
            },
            {
                id: 4,
                text: "–§–æ—Ä–º—É–ª–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–≥–ª–∞:",
                options: [
                    "Œ± = n1/n2",
                    "Œ± = arcsin(n2/n1)",
                    "Œ± = arcsin(n1/n2)",
                    "Œ± = n2/n1"
                ],
                correct: 1,
                isCalc: false
            },
            {
                id: 5,
                text: "–î–ª—è –ü–í–û —Å–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –∏–¥—Ç–∏...",
                options: [
                    "–ò–∑ –º–µ–Ω–µ–µ –ø–ª–æ—Ç–Ω–æ–π –≤ –±–æ–ª–µ–µ –ø–ª–æ—Ç–Ω—É—é",
                    "–ò–∑ –±–æ–ª–µ–µ –ø–ª–æ—Ç–Ω–æ–π –≤ –º–µ–Ω–µ–µ –ø–ª–æ—Ç–Ω—É—é",
                    "–í –≤–∞–∫—É—É–º–µ",
                    "–í –ª—é–±–æ–π —Å—Ä–µ–¥–µ"
                ],
                correct: 1,
                isCalc: false
            },

            // 6-10: –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å –ø—Ä–µ–ª–æ–º–ª–µ–Ω–∏—è
            {
                id: 6,
                text: "–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å –ø—Ä–µ–ª–æ–º–ª–µ–Ω–∏—è?",
                options: [
                    "–í–æ —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ —Å–∫–æ—Ä–æ—Å—Ç—å —Å–≤–µ—Ç–∞ –≤ –≤–∞–∫—É—É–º–µ –±–æ–ª—å—à–µ, —á–µ–º –≤ —Å—Ä–µ–¥–µ",
                    "–ü–ª–æ—Ç–Ω–æ—Å—Ç—å –≤–µ—â–µ—Å—Ç–≤–∞",
                    "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É —Å—Ä–µ–¥—ã",
                    "–î–ª–∏–Ω—É –≤–æ–ª–Ω—ã"
                ],
                correct: 0,
                isCalc: false
            },
            {
                id: 7,
                text: "–£ –∫–∞–∫–æ–π —Å—Ä–µ–¥—ã –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å –ø—Ä–µ–ª–æ–º–ª–µ–Ω–∏—è –±–æ–ª—å—à–µ?",
                options: [
                    "–í–∞–∫—É—É–º (1.0)",
                    "–í–æ–∑–¥—É—Ö (1.0003)",
                    "–í–æ–¥–∞ (1.33)",
                    "–°—Ç–µ–∫–ª–æ (1.5)"
                ],
                correct: 3,
                isCalc: false
            },
            {
                id: 8,
                text: "n = c/v. –ï—Å–ª–∏ n —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è, —Å–∫–æ—Ä–æ—Å—Ç—å —Å–≤–µ—Ç–∞...",
                options: [
                    "–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è",
                    "–£–º–µ–Ω—å—à–∞–µ—Ç—Å—è",
                    "–ù–µ –º–µ–Ω—è–µ—Ç—Å—è",
                    "–°—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω—É–ª–µ–≤–æ–π"
                ],
                correct: 1,
                isCalc: false
            },
            {
                id: 9,
                text: "–í –∫–∞–∫–æ–π —Å—Ä–µ–¥–µ —Å–≤–µ—Ç –¥–≤–∏–∂–µ—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ –≤—Å–µ–≥–æ?",
                options: [
                    "–í —Å—Ç–µ–∫–ª–µ",
                    "–í –≤–æ–¥–µ",
                    "–í –≤–∞–∫—É—É–º–µ",
                    "–í –∞–ª–º–∞–∑–µ"
                ],
                correct: 2,
                isCalc: false
            },
            {
                id: 10,
                text: "–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å –ø—Ä–µ–ª–æ–º–ª–µ–Ω–∏—è –∞–ª–º–∞–∑–∞ ‚âà",
                options: [
                    "1.33",
                    "1.5",
                    "2.4",
                    "3.5"
                ],
                correct: 2,
                isCalc: false
            },

            // 11-15: –û–ø—Ç–æ–≤–æ–ª–æ–∫–Ω–æ
            {
                id: 11,
                text: "–ò–∑ —á–µ–≥–æ —Å–æ—Å—Ç–æ–∏—Ç –æ–ø—Ç–æ–≤–æ–ª–æ–∫–Ω–æ?",
                options: [
                    "–ò–∑ –º–µ–¥–∏ –∏ –∏–∑–æ–ª—è—Ü–∏–∏",
                    "–ò–∑ —Å–µ—Ä–¥—Ü–µ–≤–∏–Ω—ã –∏ –æ–±–æ–ª–æ—á–∫–∏",
                    "–ò–∑ —Å—Ç–µ–∫–ª–∞ –∏ –ø–ª–∞—Å—Ç–∏–∫–∞",
                    "–ò–∑ –≤–æ–∑–¥—É—Ö–∞"
                ],
                correct: 1,
                isCalc: false
            },
            {
                id: 12,
                text: "–£ —Å–µ—Ä–¥—Ü–µ–≤–∏–Ω—ã –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å –ø—Ä–µ–ª–æ–º–ª–µ–Ω–∏—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å...",
                options: [
                    "–ú–µ–Ω—å—à–µ, —á–µ–º —É –æ–±–æ–ª–æ—á–∫–∏",
                    "–ë–æ–ª—å—à–µ, —á–µ–º —É –æ–±–æ–ª–æ—á–∫–∏",
                    "–†–∞–≤–µ–Ω –æ–±–æ–ª–æ—á–∫–µ",
                    "–õ—é–±–æ–π"
                ],
                correct: 1,
                isCalc: false
            },
            {
                id: 13,
                text: "–ü–æ—á–µ–º—É —Å–≤–µ—Ç –Ω–µ –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ –æ–ø—Ç–æ–≤–æ–ª–æ–∫–Ω–∞?",
                options: [
                    "–ò–∑-–∑–∞ –∑–µ—Ä–∫–∞–ª—å–Ω–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è",
                    "–ò–∑-–∑–∞ –ø–æ–ª–Ω–æ–≥–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –æ—Ç—Ä–∞–∂–µ–Ω–∏—è",
                    "–ò–∑-–∑–∞ –≤–∞–∫—É—É–º–∞ –≤–Ω—É—Ç—Ä–∏",
                    "–ò–∑-–∑–∞ –º–∞–≥–Ω–∏—Ç–Ω–æ–≥–æ –ø–æ–ª—è"
                ],
                correct: 1,
                isCalc: false
            },
            {
                id: 14,
                text: "–û–¥–Ω–æ–º–æ–¥–æ–≤–æ–µ –≤–æ–ª–æ–∫–Ω–æ –∏–º–µ–µ—Ç –¥–∏–∞–º–µ—Ç—Ä —Å–µ—Ä–¥—Ü–µ–≤–∏–Ω—ã:",
                options: [
                    "8 –º–∫–º",
                    "50 –º–∫–º",
                    "1 –º–º",
                    "1 —Å–º"
                ],
                correct: 0,
                isCalc: false
            },
            {
                id: 15,
                text: "–ú–Ω–æ–≥–æ–º–æ–¥–æ–≤–æ–µ –≤–æ–ª–æ–∫–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è...",
                options: [
                    "–°–≤–µ—Ä—Ö–¥–∞–ª—å–Ω–µ–π —Å–≤—è–∑–∏",
                    "–ö–æ—Ä–æ—Ç–∫–∏—Ö –¥–∏—Å—Ç–∞–Ω—Ü–∏–π",
                    "–ö–æ—Å–º–∏—á–µ—Å–∫–æ–π —Å–≤—è–∑–∏",
                    "–ü–æ–¥–≤–æ–¥–Ω—ã—Ö –∫–∞–±–µ–ª–µ–π"
                ],
                correct: 1,
                isCalc: false
            },

            // 16-20: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ
            {
                id: 16,
                text: "–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–ø—Ç–æ–≤–æ–ª–æ–∫–Ω–æ –≤ –º–µ–¥–∏—Ü–∏–Ω–µ?",
                options: [
                    "–†–µ–Ω—Ç–≥–µ–Ω",
                    "–≠–Ω–¥–æ—Å–∫–æ–ø",
                    "–£–ó–ò",
                    "–¢–æ–º–æ–≥—Ä–∞—Ñ"
                ],
                correct: 1,
                isCalc: false
            },
            {
                id: 17,
                text: "–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ –æ–ø—Ç–æ–≤–æ–ª–æ–∫–Ω–∞ –ø–µ—Ä–µ–¥ –º–µ–¥–Ω—ã–º –ø—Ä–æ–≤–æ–¥–æ–º:",
                options: [
                    "–î–µ—à–µ–≤–ª–µ",
                    "–ù–µ—Ç –ø–æ–º–µ—Ö, –≤—ã—à–µ —Å–∫–æ—Ä–æ—Å—Ç—å",
                    "–õ–µ–≥—á–µ –ø–∞—è—Ç—å",
                    "–ú–µ–Ω—å—à–µ –≤–µ—Å–∏—Ç"
                ],
                correct: 1,
                isCalc: false
            },
            {
                id: 18,
                text: "–ö–∞–∫ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ –æ–ø—Ç–æ–≤–æ–ª–æ–∫–Ω—É?",
                options: [
                    "–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ–º",
                    "–°–≤–µ—Ç–æ–≤—ã–º–∏ –∏–º–ø—É–ª—å—Å–∞–º–∏",
                    "–†–∞–¥–∏–æ–≤–æ–ª–Ω–∞–º–∏",
                    "–ó–≤—É–∫–æ–º"
                ],
                correct: 1,
                isCalc: false
            },
            {
                id: 19,
                text: "–ù–∞ –∫–∞–∫–æ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏ —Å—Ç–∞–≤—è—Ç —É—Å–∏–ª–∏—Ç–µ–ª–∏?",
                options: [
                    "–ö–∞–∂–¥—ã–µ 10 –∫–º",
                    "–ö–∞–∂–¥—ã–µ 100 –∫–º",
                    "–ö–∞–∂–¥—ã–µ 1000 –∫–º",
                    "–ù–µ —Å—Ç–∞–≤—è—Ç"
                ],
                correct: 1,
                isCalc: false
            },
            {
                id: 20,
                text: "–ü–æ–¥–≤–æ–¥–Ω—ã–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–∫–∞–±–µ–ª–∏ –¥–µ–ª–∞—é—Ç –∏–∑:",
                options: [
                    "–ú–µ–¥–∏",
                    "–û–ø—Ç–æ–≤–æ–ª–æ–∫–Ω–∞",
                    "–ê–ª—é–º–∏–Ω–∏—è",
                    "–ó–æ–ª–æ—Ç–∞"
                ],
                correct: 1,
                isCalc: false
            },

            // 21-25: –†–∞–∑–Ω–æ–µ
            {
                id: 21,
                text: "–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ —É–≥–ª–µ –ø–∞–¥–µ–Ω–∏—è –±–æ–ª—å—à–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ?",
                options: [
                    "–°–≤–µ—Ç –≤—ã—Ö–æ–¥–∏—Ç –Ω–∞—Ä—É–∂—É",
                    "–ü–æ–ª–Ω–æ–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ",
                    "–°–≤–µ—Ç –ø–æ–≥–ª–æ—â–∞–µ—Ç—Å—è",
                    "–°–≤–µ—Ç –º–µ–Ω—è–µ—Ç —Ü–≤–µ—Ç"
                ],
                correct: 1,
                isCalc: false
            },
            {
                id: 22,
                text: "–Ø–≤–ª–µ–Ω–∏–µ –ü–í–û –º–æ–∂–Ω–æ –Ω–∞–±–ª—é–¥–∞—Ç—å:",
                options: [
                    "–¢–æ–ª—å–∫–æ –≤ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏",
                    "–í –ø—Ä–∏—Ä–æ–¥–µ (–º–∏—Ä–∞–∂–∏, –∞–ª–º–∞–∑—ã)",
                    "–¢–æ–ª—å–∫–æ –≤ –≤–∞–∫—É—É–º–µ",
                    "–¢–æ–ª—å–∫–æ –≤ –≤–æ–¥–µ"
                ],
                correct: 1,
                isCalc: false
            },
            {
                id: 23,
                text: "–ß—Ç–æ —Ç–∞–∫–æ–µ –∑–∞—Ç—É—Ö–∞–Ω–∏–µ –≤ –æ–ø—Ç–æ–≤–æ–ª–æ–∫–Ω–µ?",
                options: [
                    "–ü–æ—Ç–µ—Ä—è —Å–∏–≥–Ω–∞–ª–∞",
                    "–£—Å–∏–ª–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞",
                    "–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞",
                    "–ù–∞–≥—Ä–µ–≤ –∫–∞–±–µ–ª—è"
                ],
                correct: 0,
                isCalc: false
            },
            {
                id: 24,
                text: "–î–ª–∏–Ω–∞ –≤–æ–ª–Ω—ã 1550 –Ω–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:",
                options: [
                    "–ö–æ—Ä–æ—Ç–∫–∏—Ö –ª–∏–Ω–∏–π",
                    "–î–∞–ª—å–Ω–µ–π —Å–≤—è–∑–∏",
                    "–û—Å–≤–µ—â–µ–Ω–∏—è",
                    "–ú–µ–¥–∏—Ü–∏–Ω—ã"
                ],
                correct: 1,
                isCalc: false
            },
            {
                id: 25,
                text: "–ß—Ç–æ —Ç–∞–∫–æ–µ –¥–∏—Å–ø–µ—Ä—Å–∏—è –≤ –æ–ø—Ç–æ–≤–æ–ª–æ–∫–Ω–µ?",
                options: [
                    "–†–∞—Å–ø–ª—ã–≤–∞–Ω–∏–µ –∏–º–ø—É–ª—å—Å–∞",
                    "–£—Å–∏–ª–µ–Ω–∏–µ —Å–≤–µ—Ç–∞",
                    "–û—Ç—Ä–∞–∂–µ–Ω–∏–µ —Å–≤–µ—Ç–∞",
                    "–ü–æ–≥–ª–æ—â–µ–Ω–∏–µ —Å–≤–µ—Ç–∞"
                ],
                correct: 0,
                isCalc: false
            },

            // ===== 26-30: –†–ê–°–ß–Å–¢–ù–´–ï (–≤ —Ç–µ—Ç—Ä–∞–¥–∏) =====
            {
                id: 26,
                text: "üßÆ –°–∫–æ—Ä–æ—Å—Ç—å —Å–≤–µ—Ç–∞ –≤ —Å—Ç–µ–∫–ª–µ 200 000 –∫–º/—Å. –ù–∞–π–¥–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å –ø—Ä–µ–ª–æ–º–ª–µ–Ω–∏—è —Å—Ç–µ–∫–ª–∞. (c = 300 000 –∫–º/—Å)",
                options: [
                    "1.33",
                    "1.5",
                    "1.8",
                    "2.0"
                ],
                correct: 1,
                isCalc: true,
                formula: "n = c/v"
            },
            {
                id: 27,
                text: "üßÆ –õ—É—á –ø–∞–¥–∞–µ—Ç –∏–∑ –≤–æ–∑–¥—É—Ö–∞ (n=1) –≤ –≤–æ–¥—É (n=1.33) –ø–æ–¥ —É–≥–ª–æ–º 45¬∞. –ù–∞–π–¥–∏ —É–≥–æ–ª –ø—Ä–µ–ª–æ–º–ª–µ–Ω–∏—è. sin45¬∞ = 0.707",
                options: [
                    "28¬∞",
                    "32¬∞",
                    "38¬∞",
                    "42¬∞"
                ],
                correct: 1,
                isCalc: true,
                formula: "n‚ÇÅ¬∑sinŒ± = n‚ÇÇ¬∑sinŒ≤"
            },
            {
                id: 28,
                text: "üßÆ –ù–∞–π–¥–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É–≥–æ–ª –¥–ª—è –≥—Ä–∞–Ω–∏—Ü—ã —Å—Ç–µ–∫–ª–æ-–≤–æ–∑–¥—É—Ö. n —Å—Ç–µ–∫–ª–∞ = 1.5",
                options: [
                    "38¬∞",
                    "42¬∞",
                    "48¬∞",
                    "52¬∞"
                ],
                correct: 1,
                isCalc: true,
                formula: "Œ±–∫—Ä = arcsin(n‚ÇÇ/n‚ÇÅ)"
            },
            {
                id: 29,
                text: "üßÆ –°–≤–µ—Ç –∏–¥—ë—Ç –∏–∑ –≤–æ–¥—ã (n=1.33) –≤ –∞–ª–º–∞–∑ (n=2.4). –£–≥–æ–ª –ø–∞–¥–µ–Ω–∏—è 50¬∞. –ù–∞–π–¥–∏ —É–≥–æ–ª –ø—Ä–µ–ª–æ–º–ª–µ–Ω–∏—è. sin50¬∞ = 0.766",
                options: [
                    "24¬∞",
                    "28¬∞",
                    "32¬∞",
                    "36¬∞"
                ],
                correct: 0,
                isCalc: true,
                formula: "n‚ÇÅ¬∑sinŒ± = n‚ÇÇ¬∑sinŒ≤"
            },
            {
                id: 30,
                text: "üßÆ –°–∏–≥–Ω–∞–ª –∏–¥—ë—Ç –ø–æ –æ–ø—Ç–æ–≤–æ–ª–æ–∫–Ω—É 200 –∫–º. –°–∫–æ—Ä–æ—Å—Ç—å —Å–≤–µ—Ç–∞ –≤ –≤–æ–ª–æ–∫–Ω–µ 200 000 –∫–º/—Å. –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–π–º—ë—Ç –ø–µ—Ä–µ–¥–∞—á–∞?",
                options: [
                    "0.1 –º—Å",
                    "1 –º—Å",
                    "10 –º—Å",
                    "100 –º—Å"
                ],
                correct: 1,
                isCalc: true,
                formula: "t = s / v"
            }
        ];

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        let gameId = null;
        let playerName = '';
        let currentQuestion = 0;
        let answers = {};
        let timerInterval = null;
        let gameData = null;

        // ===== –°–û–ó–î–ê–Å–ú –§–û–¢–û–ù–´ =====
        for (let i = 0; i < 30; i++) {
            const photon = document.createElement('div');
            photon.className = 'photon';
            photon.style.left = Math.random() * 100 + '%';
            photon.style.top = Math.random() * 100 + '%';
            photon.style.animationDelay = Math.random() * 10 + 's';
            photon.style.animationDuration = (15 + Math.random() * 20) + 's';
            document.getElementById('photons').appendChild(photon);
        }

        // ===== –í–•–û–î =====
        window.joinGame = function() {
            const name = document.getElementById('playerName').value.trim();
            const code = document.getElementById('gameCode').value.trim();

            if (!name) return showError('–í–≤–µ–¥–∏ –∏–º—è');
            if (!code || code.length !== 6) return showError('–ö–æ–¥: 6 —Ü–∏—Ñ—Ä');

            playerName = name;
            gameId = `game_${code}`;

            document.getElementById('displayName').innerText = name;
            document.getElementById('displayCode').innerText = code;

            db.ref(`games/${gameId}`).once('value', (snap) => {
                gameData = snap.val();
                if (!gameData) return showError('–ò–≥—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');

                db.ref(`games/${gameId}/players/${name}`).set({
                    name: name,
                    joinedAt: Date.now(),
                    answers: {}
                });

                switchScreen('lobby', 'wait');
                listenToGame();
            });
        };

        // ===== –°–õ–£–®–ê–¢–¨ =====
        function listenToGame() {
            db.ref(`games/${gameId}`).on('value', (snap) => {
                gameData = snap.val();
                if (!gameData) return;

                if (gameData.players) {
                    document.getElementById('playersCount').innerText = 
                        Object.keys(gameData.players).length + ' –∏–≥—Ä–æ–∫–æ–≤';
                }

                if (gameData.status === 'active') {
                    switchScreen('wait', 'game');
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Ç–≤–µ—Ç—ã, –µ—Å–ª–∏ –µ—Å—Ç—å
                    if (gameData.players && gameData.players[playerName]) {
                        answers = gameData.players[playerName].answers || {};
                    }
                    
                    renderGrid();
                    showQuestion(currentQuestion);
                    
                    if (gameData.startTime) {
                        startTimer(gameData.startTime, gameData.timeLimit || 900);
                    }
                }

                if (gameData.status === 'finished') {
                    finishGame();
                }
            });
        }

        // ===== –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –≠–ö–†–ê–ù–û–í =====
        function switchScreen(from, to) {
            document.getElementById(`screen${from.charAt(0).toUpperCase() + from.slice(1)}`).classList.add('hidden');
            document.getElementById(`screen${to.charAt(0).toUpperCase() + to.slice(1)}`).classList.remove('hidden');
        }

        // ===== –¢–ê–ô–ú–ï–† =====
        function startTimer(startTime, limit) {
            if (timerInterval) clearInterval(timerInterval);
            
            timerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                const remaining = Math.max(0, limit - elapsed);
                const mins = Math.floor(remaining / 60);
                const secs = remaining % 60;
                
                document.getElementById('displayTimer').innerText = 
                    `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                
                if (remaining <= 0) {
                    clearInterval(timerInterval);
                    submitTest();
                }
            }, 1000);
        }

        // ===== –°–ï–¢–ö–ê –í–û–ü–†–û–°–û–í =====
        function renderGrid() {
            let html = '';
            for (let i = 1; i <= 30; i++) {
                const answered = answers[i] !== undefined ? 'answered' : '';
                const current = i === currentQuestion + 1 ? 'current' : '';
                const calcClass = QUESTIONS[i-1].isCalc ? 'calc' : '';
                html += `<div class="grid-item ${answered} ${current} ${calcClass}" onclick="jumpToQuestion(${i-1})">${i}</div>`;
            }
            document.getElementById('questionsGrid').innerHTML = html;
            
            const answeredCount = Object.keys(answers).length;
            document.getElementById('answeredCount').innerText = `‚úÖ ${answeredCount}/30`;
            document.getElementById('progressFill').style.width = (answeredCount / 30 * 100) + '%';
        }

        window.jumpToQuestion = (index) => {
            currentQuestion = index;
            renderGrid();
            showQuestion(index);
        };

        // ===== –ü–û–ö–ê–ó–ê–¢–¨ –í–û–ü–†–û–° =====
        function showQuestion(index) {
            const q = QUESTIONS[index];
            
            document.getElementById('questionText').innerText = q.text;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É–ª—É –¥–ª—è —Ä–∞—Å—á—ë—Ç–Ω—ã—Ö
            if (q.isCalc) {
                document.getElementById('calcNote').classList.remove('hidden');
                document.getElementById('formulaDisplay').innerHTML = `<div class="formula">üìê ${q.formula}</div>`;
                document.getElementById('formulaDisplay').classList.remove('hidden');
            } else {
                document.getElementById('calcNote').classList.add('hidden');
                document.getElementById('formulaDisplay').classList.add('hidden');
            }

            // –í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤
            let optionsHtml = '';
            const prefixes = ['prefix-a', 'prefix-b', 'prefix-c', 'prefix-d'];
            q.options.forEach((opt, i) => {
                const selected = answers[q.id] === i ? 'selected' : '';
                optionsHtml += `
                    <div class="option ${prefixes[i]} ${selected}" onclick="selectAnswer(${q.id}, ${i})">
                        ${opt}
                    </div>
                `;
            });
            document.getElementById('optionsContainer').innerHTML = optionsHtml;
        }

        // ===== –í–´–ë–û–† –û–¢–í–ï–¢–ê =====
        window.selectAnswer = (qid, optIndex) => {
            answers[qid] = optIndex;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Firebase
            db.ref(`games/${gameId}/players/${playerName}/answers/${qid}`).set(optIndex);
            
            renderGrid();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ –≤ —Ç–µ–∫—É—â–µ–º –≤–æ–ø—Ä–æ—Å–µ
            document.querySelectorAll('.option').forEach((opt, i) => {
                if (i === optIndex) {
                    opt.classList.add('selected');
                } else {
                    opt.classList.remove('selected');
                }
            });
        };

        // ===== –ù–ê–í–ò–ì–ê–¶–ò–Ø =====
        window.prevQuestion = () => {
            if (currentQuestion > 0) {
                currentQuestion--;
                renderGrid();
                showQuestion(currentQuestion);
            }
        };

        window.nextQuestion = () => {
            if (currentQuestion < 29) {
                currentQuestion++;
                renderGrid();
                showQuestion(currentQuestion);
            }
        };

        // ===== –û–¢–ü–†–ê–í–ö–ê =====
        window.submitTest = function() {
            const answered = Object.keys(answers).length;
            if (answered < 30) {
                if (!confirm(`–û—Ç–≤–µ—Ç–æ–≤: ${answered}/30. –í—Å—ë —Ä–∞–≤–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å?`)) return;
            }

            // –ü–æ–¥—Å—á—ë—Ç –±–∞–ª–ª–æ–≤ (–ø–æ 3.33 –∑–∞ –∫–∞–∂–¥—ã–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π ‚âà 100)
            let correct = 0;
            for (let i = 1; i <= 30; i++) {
                if (answers[i] === QUESTIONS[i-1].correct) correct++;
            }
            const score = Math.round(correct * 3.33);

            db.ref(`games/${gameId}/players/${playerName}`).update({
                answers: answers,
                score: score,
                correct: correct,
                submittedAt: Date.now()
            }).then(() => {
                finishGame();
            });
        };

        // ===== –ó–ê–í–ï–†–®–ï–ù–ò–ï =====
        function finishGame() {
            if (timerInterval) clearInterval(timerInterval);
            
            db.ref(`games/${gameId}/players/${playerName}`).once('value', (snap) => {
                const player = snap.val();
                const score = player.score || 0;
                const correct = player.correct || 0;
                
                switchScreen('game', 'result');
                document.getElementById('finalScore').innerText = score + ' ‚ú®';
                
                let message = `–ü—Ä–∞–≤–∏–ª—å–Ω–æ: ${correct}/30\n`;
                if (correct >= 27) message += 'üåü –û—Ç–ª–∏—á–Ω–æ!';
                else if (correct >= 24) message += 'üí´ –•–æ—Ä–æ—à–æ!';
                else if (correct >= 18) message += 'üìö –ù–∞–¥–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å';
                else message += 'üîÆ –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë';
                
                document.getElementById('finalMessage').innerText = message;
            });
        }

        // ===== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï =====
        function showError(msg) {
            document.getElementById('errorMsg').innerText = msg;
        }

        window.exit = () => {
            location.href = 'index.html';
        };

        // –§–æ—Ä–º–∞—Ç –∫–æ–¥–∞ (—Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã)
        document.getElementById('gameCode')?.addEventListener('input', function() {
            this.value = this.value.replace(/\D/g, '').substring(0, 6);
        });
    </script>
</body>
</html>
