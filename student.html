<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FIBER OPTIC ¬∑ —Ç–µ—Å—Ç</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background: #f5f5f7;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .student-container {
            width: 100%;
            max-width: 600px;
            background: white;
            border-radius: 32px;
            padding: 32px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.02);
            border: 1px solid #f0f0f3;
        }

        /* –®–ê–ü–ö–ê */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .name-badge {
            background: #f5f5f7;
            padding: 10px 20px;
            border-radius: 30px;
            font-weight: 500;
            color: #1d1d1f;
        }

        .timer {
            font-family: 'SF Mono', 'Courier New', monospace;
            font-size: 2.2rem;
            font-weight: 500;
            color: #1d1d1f;
            background: #f5f5f7;
            padding: 8px 24px;
            border-radius: 30px;
        }

        /* –ü–†–û–ì–†–ï–°–° */
        .progress-section {
            margin-bottom: 24px;
        }

        .progress-stats {
            display: flex;
            justify-content: space-between;
            color: #6e6e73;
            font-size: 0.95rem;
            margin-bottom: 8px;
        }

        .progress-bar {
            height: 4px;
            background: #e9e9ed;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #0071e3;
            width: 0%;
            transition: width 0.3s;
        }

        /* –ö–ê–†–¢–û–ß–ö–ê –í–û–ü–†–û–°–ê */
        .question-card {
            background: #f5f5f7;
            border-radius: 28px;
            padding: 28px;
            margin: 20px 0;
        }

        .question-text {
            font-size: 1.2rem;
            line-height: 1.5;
            color: #1d1d1f;
            font-weight: 500;
            margin-bottom: 24px;
        }

        /* –†–ê–°–ß–Å–¢–ù–´–ô –ë–õ–û–ö */
        .calc-block {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 24px;
            border: 1px solid #e9e9ed;
        }

        .calc-label {
            color: #6e6e73;
            font-size: 0.85rem;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .formula {
            font-family: 'SF Mono', 'Courier New', monospace;
            font-size: 1.2rem;
            background: #f5f5f7;
            padding: 12px 16px;
            border-radius: 14px;
            color: #1d1d1f;
        }

        /* –í–ê–†–ò–ê–ù–¢–´ –û–¢–í–ï–¢–û–í */
        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .option {
            background: white;
            border: 1px solid #e9e9ed;
            border-radius: 18px;
            padding: 16px 20px;
            font-size: 1rem;
            color: #1d1d1f;
            cursor: pointer;
            transition: all 0.2s;
        }

        .option:hover {
            border-color: #0071e3;
        }

        .option.selected {
            background: #0071e3;
            border-color: #0071e3;
            color: white;
        }

        /* –ù–ê–í–ò–ì–ê–¶–ò–Ø */
        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }

        .nav-arrows {
            display: flex;
            gap: 8px;
        }

        .nav-arrow {
            width: 48px;
            height: 48px;
            background: white;
            border: 1px solid #d2d2d7;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: #1d1d1f;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-arrow:hover {
            border-color: #0071e3;
            color: #0071e3;
        }

        .submit-btn {
            background: #0071e3;
            color: white;
            border: none;
            border-radius: 40px;
            padding: 12px 28px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .submit-btn:hover {
            background: #0077ed;
        }

        /* –≠–ö–†–ê–ù–´ */
        .screen {
            display: flex;
            flex-direction: column;
        }

        .hidden {
            display: none !important;
        }

        /* –ü–û–õ–Ø –í–í–û–î–ê */
        .input-field {
            background: #f5f5f7;
            border: 1px solid #e9e9ed;
            border-radius: 18px;
            padding: 16px 20px;
            font-size: 1rem;
            width: 100%;
            margin: 8px 0;
        }

        .input-field:focus {
            outline: none;
            border-color: #0071e3;
        }

        .action-btn {
            background: #0071e3;
            color: white;
            border: none;
            border-radius: 30px;
            padding: 16px;
            font-size: 1rem;
            font-weight: 500;
            width: 100%;
            margin: 8px 0;
            cursor: pointer;
        }

        /* –ö–û–î –û–ñ–ò–î–ê–ù–ò–Ø */
        .code-display {
            font-family: 'SF Mono', 'Courier New', monospace;
            font-size: 4rem;
            text-align: center;
            padding: 30px;
            background: #f5f5f7;
            border-radius: 40px;
            margin: 30px 0;
            letter-spacing: 10px;
            color: #1d1d1f;
        }

        /* –†–ï–ó–£–õ–¨–¢–ê–¢ */
        .score-display {
            font-size: 5rem;
            font-weight: 700;
            text-align: center;
            margin: 30px 0;
            color: #1d1d1f;
        }

        .message {
            text-align: center;
            color: #6e6e73;
            font-size: 1.1rem;
        }

        .text-center {
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="student-container">
        <!-- –≠–ö–†–ê–ù –í–•–û–î–ê -->
        <div id="screenLobby" class="screen">
            <h1 style="font-size: 2.2rem; margin-bottom: 8px;">FIBER OPTIC</h1>
            <div style="color: #6e6e73; margin-bottom: 32px;">30 –∑–∞–¥–∞–Ω–∏–π ¬∑ –ø–æ–ª–Ω–æ–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ</div>
            
            <input type="text" id="playerName" class="input-field" placeholder="–¢–≤–æ—ë –∏–º—è" maxlength="15">
            <input type="text" id="gameCode" class="input-field" placeholder="–ö–æ–¥ —Ç–µ—Å—Ç–∞ (6 —Ü–∏—Ñ—Ä)" maxlength="6">
            
            <button class="action-btn" onclick="joinGame()">–í–æ–π—Ç–∏</button>
            <div id="errorMsg" style="color: #ff3b30; margin-top: 16px; text-align: center;"></div>
        </div>

        <!-- –≠–ö–†–ê–ù –û–ñ–ò–î–ê–ù–ò–Ø -->
        <div id="screenWait" class="screen hidden">
            <h1 style="text-align: center;">–û–∂–∏–¥–∞–Ω–∏–µ</h1>
            <div class="code-display" id="displayCode">000000</div>
            <div style="text-align: center; font-size: 1.2rem;" id="playersCount">0 –∏–≥—Ä–æ–∫–æ–≤</div>
        </div>

        <!-- –≠–ö–†–ê–ù –¢–ï–°–¢–ê -->
        <div id="screenGame" class="screen hidden">
            <!-- –®–∞–ø–∫–∞ -->
            <div class="header">
                <span class="name-badge" id="displayName"></span>
                <span class="timer" id="displayTimer">15:00</span>
            </div>

            <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å -->
            <div class="progress-section">
                <div class="progress-stats">
                    <span id="answeredCount">0/30</span>
                    <span>üßÆ 5 —Ä–∞—Å—á—ë—Ç–Ω—ã—Ö</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>

            <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –≤–æ–ø—Ä–æ—Å–∞ -->
            <div class="question-card">
                <div class="question-text" id="questionText"></div>
                
                <div id="calcBlock" class="calc-block hidden">
                    <div class="calc-label">–†–∞—Å—á—ë—Ç –≤ —Ç–µ—Ç—Ä–∞–¥–∏</div>
                    <div class="formula" id="formulaDisplay"></div>
                </div>
                
                <div class="options" id="optionsContainer"></div>
            </div>

            <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
            <div class="navigation">
                <div class="nav-arrows">
                    <div class="nav-arrow" onclick="prevQuestion()">‚Üê</div>
                    <div class="nav-arrow" onclick="nextQuestion()">‚Üí</div>
                </div>
                <button class="submit-btn" onclick="submitTest()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>
        </div>

        <!-- –≠–ö–†–ê–ù –†–ï–ó–£–õ–¨–¢–ê–¢–ê -->
        <div id="screenResult" class="screen hidden">
            <h1 style="text-align: center;">–†–µ–∑—É–ª—å—Ç–∞—Ç</h1>
            <div class="score-display" id="finalScore">0</div>
            <div class="message" id="finalMessage"></div>
            <button class="action-btn" style="margin-top: 40px;" onclick="exit()">–í—ã–π—Ç–∏</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyC_86gSXMHhRXk3q63usfJK3fQrFhQU7Ig",
            authDomain: "physicsproject-b5660.firebaseapp.com",
            databaseURL: "https://physicsproject-b5660-default-rtdb.firebaseio.com",
            projectId: "physicsproject-b5660",
            storageBucket: "physicsproject-b5660.firebasestorage.app",
            messagingSenderId: "244631414073",
            appId: "1:244631414073:web:69b4bdc74e233051f474e8"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // ===== 30 –í–û–ü–†–û–°–û–í =====
        const QUESTIONS = [
            { id: 1, text: "–ß—Ç–æ —Ç–∞–∫–æ–µ –ø–æ–ª–Ω–æ–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ?", options: [
                "–û—Ç—Ä–∞–∂–µ–Ω–∏–µ —Å–≤–µ—Ç–∞ –æ—Ç –∑–µ—Ä–∫–∞–ª–∞",
                "–û—Ç—Ä–∞–∂–µ–Ω–∏–µ –±–µ–∑ –≤—ã—Ö–æ–¥–∞ –≤ –¥—Ä—É–≥—É—é —Å—Ä–µ–¥—É",
                "–ü—Ä–µ–ª–æ–º–ª–µ–Ω–∏–µ –ø–æ–¥ –ø—Ä—è–º—ã–º —É–≥–ª–æ–º",
                "–ü–æ–≥–ª–æ—â–µ–Ω–∏–µ —Å–≤–µ—Ç–∞"
            ], correct: 1, isCalc: false },
            
            { id: 2, text: "–ü—Ä–∏ –∫–∞–∫–æ–º —É—Å–ª–æ–≤–∏–∏ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –ü–í–û?", options: [
                "n‚ÇÅ < n‚ÇÇ, —É–≥–æ–ª –ª—é–±–æ–π",
                "n‚ÇÅ > n‚ÇÇ, —É–≥–æ–ª > –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ",
                "n‚ÇÅ = n‚ÇÇ",
                "–≤ –≤–∞–∫—É—É–º–µ"
            ], correct: 1, isCalc: false },
            
            { id: 3, text: "–ß—Ç–æ —Ç–∞–∫–æ–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É–≥–æ–ª?", options: [
                "–£–≥–æ–ª, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º —Å–≤–µ—Ç –≥–∞—Å–Ω–µ—Ç",
                "–£–≥–æ–ª, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ü–í–û",
                "–£–≥–æ–ª –ø–æ–ª–Ω–æ–π –ø–æ–ª—è—Ä–∏–∑–∞—Ü–∏–∏",
                "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É–≥–æ–ª –ø—Ä–µ–ª–æ–º–ª–µ–Ω–∏—è"
            ], correct: 1, isCalc: false },
            
            { id: 4, text: "–§–æ—Ä–º—É–ª–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–≥–ª–∞:", options: [
                "Œ± = n‚ÇÅ/n‚ÇÇ",
                "Œ± = arcsin(n‚ÇÇ/n‚ÇÅ)",
                "Œ± = arcsin(n‚ÇÅ/n‚ÇÇ)",
                "Œ± = n‚ÇÇ/n‚ÇÅ"
            ], correct: 1, isCalc: false },
            
            { id: 5, text: "–î–ª—è –ü–í–û —Å–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –∏–¥—Ç–∏...", options: [
                "–ò–∑ –º–µ–Ω–µ–µ –ø–ª–æ—Ç–Ω–æ–π –≤ –±–æ–ª–µ–µ –ø–ª–æ—Ç–Ω—É—é",
                "–ò–∑ –±–æ–ª–µ–µ –ø–ª–æ—Ç–Ω–æ–π –≤ –º–µ–Ω–µ–µ –ø–ª–æ—Ç–Ω—É—é",
                "–í –≤–∞–∫—É—É–º–µ",
                "–í –ª—é–±–æ–π —Å—Ä–µ–¥–µ"
            ], correct: 1, isCalc: false },
            
            { id: 6, text: "–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å –ø—Ä–µ–ª–æ–º–ª–µ–Ω–∏—è?", options: [
                "–í–æ —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ —Å–∫–æ—Ä–æ—Å—Ç—å —Å–≤–µ—Ç–∞ –≤ –≤–∞–∫—É—É–º–µ –±–æ–ª—å—à–µ, —á–µ–º –≤ —Å—Ä–µ–¥–µ",
                "–ü–ª–æ—Ç–Ω–æ—Å—Ç—å –≤–µ—â–µ—Å—Ç–≤–∞",
                "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É —Å—Ä–µ–¥—ã",
                "–î–ª–∏–Ω—É –≤–æ–ª–Ω—ã"
            ], correct: 0, isCalc: false },
            
            { id: 7, text: "–£ –∫–∞–∫–æ–π —Å—Ä–µ–¥—ã –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å –ø—Ä–µ–ª–æ–º–ª–µ–Ω–∏—è –±–æ–ª—å—à–µ?", options: [
                "–í–∞–∫—É—É–º (1.0)",
                "–í–æ–∑–¥—É—Ö (1.0003)",
                "–í–æ–¥–∞ (1.33)",
                "–°—Ç–µ–∫–ª–æ (1.5)"
            ], correct: 3, isCalc: false },
            
            { id: 8, text: "n = c/v. –ï—Å–ª–∏ n —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è, —Å–∫–æ—Ä–æ—Å—Ç—å —Å–≤–µ—Ç–∞...", options: [
                "–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è",
                "–£–º–µ–Ω—å—à–∞–µ—Ç—Å—è",
                "–ù–µ –º–µ–Ω—è–µ—Ç—Å—è",
                "–°—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω—É–ª–µ–≤–æ–π"
            ], correct: 1, isCalc: false },
            
            { id: 9, text: "–í –∫–∞–∫–æ–π —Å—Ä–µ–¥–µ —Å–≤–µ—Ç –¥–≤–∏–∂–µ—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ –≤—Å–µ–≥–æ?", options: [
                "–í —Å—Ç–µ–∫–ª–µ",
                "–í –≤–æ–¥–µ",
                "–í –≤–∞–∫—É—É–º–µ",
                "–í –∞–ª–º–∞–∑–µ"
            ], correct: 2, isCalc: false },
            
            { id: 10, text: "–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å –ø—Ä–µ–ª–æ–º–ª–µ–Ω–∏—è –∞–ª–º–∞–∑–∞ ‚âà", options: [
                "1.33",
                "1.5",
                "2.4",
                "3.5"
            ], correct: 2, isCalc: false },
            
            { id: 11, text: "–ò–∑ —á–µ–≥–æ —Å–æ—Å—Ç–æ–∏—Ç –æ–ø—Ç–æ–≤–æ–ª–æ–∫–Ω–æ?", options: [
                "–ò–∑ –º–µ–¥–∏ –∏ –∏–∑–æ–ª—è—Ü–∏–∏",
                "–ò–∑ —Å–µ—Ä–¥—Ü–µ–≤–∏–Ω—ã –∏ –æ–±–æ–ª–æ—á–∫–∏",
                "–ò–∑ —Å—Ç–µ–∫–ª–∞ –∏ –ø–ª–∞—Å—Ç–∏–∫–∞",
                "–ò–∑ –≤–æ–∑–¥—É—Ö–∞"
            ], correct: 1, isCalc: false },
            
            { id: 12, text: "–£ —Å–µ—Ä–¥—Ü–µ–≤–∏–Ω—ã –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å –ø—Ä–µ–ª–æ–º–ª–µ–Ω–∏—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å...", options: [
                "–ú–µ–Ω—å—à–µ, —á–µ–º —É –æ–±–æ–ª–æ—á–∫–∏",
                "–ë–æ–ª—å—à–µ, —á–µ–º —É –æ–±–æ–ª–æ—á–∫–∏",
                "–†–∞–≤–µ–Ω –æ–±–æ–ª–æ—á–∫–µ",
                "–õ—é–±–æ–π"
            ], correct: 1, isCalc: false },
            
            { id: 13, text: "–ü–æ—á–µ–º—É —Å–≤–µ—Ç –Ω–µ –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ –æ–ø—Ç–æ–≤–æ–ª–æ–∫–Ω–∞?", options: [
                "–ò–∑-–∑–∞ –∑–µ—Ä–∫–∞–ª—å–Ω–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è",
                "–ò–∑-–∑–∞ –ø–æ–ª–Ω–æ–≥–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –æ—Ç—Ä–∞–∂–µ–Ω–∏—è",
                "–ò–∑-–∑–∞ –≤–∞–∫—É—É–º–∞ –≤–Ω—É—Ç—Ä–∏",
                "–ò–∑-–∑–∞ –º–∞–≥–Ω–∏—Ç–Ω–æ–≥–æ –ø–æ–ª—è"
            ], correct: 1, isCalc: false },
            
            { id: 14, text: "–û–¥–Ω–æ–º–æ–¥–æ–≤–æ–µ –≤–æ–ª–æ–∫–Ω–æ –∏–º–µ–µ—Ç –¥–∏–∞–º–µ—Ç—Ä —Å–µ—Ä–¥—Ü–µ–≤–∏–Ω—ã:", options: [
                "8 –º–∫–º",
                "50 –º–∫–º",
                "1 –º–º",
                "1 —Å–º"
            ], correct: 0, isCalc: false },
            
            { id: 15, text: "–ú–Ω–æ–≥–æ–º–æ–¥–æ–≤–æ–µ –≤–æ–ª–æ–∫–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è...", options: [
                "–°–≤–µ—Ä—Ö–¥–∞–ª—å–Ω–µ–π —Å–≤—è–∑–∏",
                "–ö–æ—Ä–æ—Ç–∫–∏—Ö –¥–∏—Å—Ç–∞–Ω—Ü–∏–π",
                "–ö–æ—Å–º–∏—á–µ—Å–∫–æ–π —Å–≤—è–∑–∏",
                "–ü–æ–¥–≤–æ–¥–Ω—ã—Ö –∫–∞–±–µ–ª–µ–π"
            ], correct: 1, isCalc: false },
            
            { id: 16, text: "–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–ø—Ç–æ–≤–æ–ª–æ–∫–Ω–æ –≤ –º–µ–¥–∏—Ü–∏–Ω–µ?", options: [
                "–†–µ–Ω—Ç–≥–µ–Ω",
                "–≠–Ω–¥–æ—Å–∫–æ–ø",
                "–£–ó–ò",
                "–¢–æ–º–æ–≥—Ä–∞—Ñ"
            ], correct: 1, isCalc: false },
            
            { id: 17, text: "–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ –æ–ø—Ç–æ–≤–æ–ª–æ–∫–Ω–∞ –ø–µ—Ä–µ–¥ –º–µ–¥–Ω—ã–º –ø—Ä–æ–≤–æ–¥–æ–º:", options: [
                "–î–µ—à–µ–≤–ª–µ",
                "–ù–µ—Ç –ø–æ–º–µ—Ö, –≤—ã—à–µ —Å–∫–æ—Ä–æ—Å—Ç—å",
                "–õ–µ–≥—á–µ –ø–∞—è—Ç—å",
                "–ú–µ–Ω—å—à–µ –≤–µ—Å–∏—Ç"
            ], correct: 1, isCalc: false },
            
            { id: 18, text: "–ö–∞–∫ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ –æ–ø—Ç–æ–≤–æ–ª–æ–∫–Ω—É?", options: [
                "–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ–º",
                "–°–≤–µ—Ç–æ–≤—ã–º–∏ –∏–º–ø—É–ª—å—Å–∞–º–∏",
                "–†–∞–¥–∏–æ–≤–æ–ª–Ω–∞–º–∏",
                "–ó–≤—É–∫–æ–º"
            ], correct: 1, isCalc: false },
            
            { id: 19, text: "–ù–∞ –∫–∞–∫–æ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏ —Å—Ç–∞–≤—è—Ç —É—Å–∏–ª–∏—Ç–µ–ª–∏?", options: [
                "–ö–∞–∂–¥—ã–µ 10 –∫–º",
                "–ö–∞–∂–¥—ã–µ 100 –∫–º",
                "–ö–∞–∂–¥—ã–µ 1000 –∫–º",
                "–ù–µ —Å—Ç–∞–≤—è—Ç"
            ], correct: 1, isCalc: false },
            
            { id: 20, text: "–ü–æ–¥–≤–æ–¥–Ω—ã–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–∫–∞–±–µ–ª–∏ –¥–µ–ª–∞—é—Ç –∏–∑:", options: [
                "–ú–µ–¥–∏",
                "–û–ø—Ç–æ–≤–æ–ª–æ–∫–Ω–∞",
                "–ê–ª—é–º–∏–Ω–∏—è",
                "–ó–æ–ª–æ—Ç–∞"
            ], correct: 1, isCalc: false },
            
            { id: 21, text: "–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ —É–≥–ª–µ –ø–∞–¥–µ–Ω–∏—è –±–æ–ª—å—à–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ?", options: [
                "–°–≤–µ—Ç –≤—ã—Ö–æ–¥–∏—Ç –Ω–∞—Ä—É–∂—É",
                "–ü–æ–ª–Ω–æ–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ",
                "–°–≤–µ—Ç –ø–æ–≥–ª–æ—â–∞–µ—Ç—Å—è",
                "–°–≤–µ—Ç –º–µ–Ω—è–µ—Ç —Ü–≤–µ—Ç"
            ], correct: 1, isCalc: false },
            
            { id: 22, text: "–Ø–≤–ª–µ–Ω–∏–µ –ü–í–û –º–æ–∂–Ω–æ –Ω–∞–±–ª—é–¥–∞—Ç—å:", options: [
                "–¢–æ–ª—å–∫–æ –≤ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏",
                "–í –ø—Ä–∏—Ä–æ–¥–µ (–º–∏—Ä–∞–∂–∏, –∞–ª–º–∞–∑—ã)",
                "–¢–æ–ª—å–∫–æ –≤ –≤–∞–∫—É—É–º–µ",
                "–¢–æ–ª—å–∫–æ –≤ –≤–æ–¥–µ"
            ], correct: 1, isCalc: false },
            
            { id: 23, text: "–ß—Ç–æ —Ç–∞–∫–æ–µ –∑–∞—Ç—É—Ö–∞–Ω–∏–µ –≤ –æ–ø—Ç–æ–≤–æ–ª–æ–∫–Ω–µ?", options: [
                "–ü–æ—Ç–µ—Ä—è —Å–∏–≥–Ω–∞–ª–∞",
                "–£—Å–∏–ª–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞",
                "–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞",
                "–ù–∞–≥—Ä–µ–≤ –∫–∞–±–µ–ª—è"
            ], correct: 0, isCalc: false },
            
            { id: 24, text: "–î–ª–∏–Ω–∞ –≤–æ–ª–Ω—ã 1550 –Ω–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:", options: [
                "–ö–æ—Ä–æ—Ç–∫–∏—Ö –ª–∏–Ω–∏–π",
                "–î–∞–ª—å–Ω–µ–π —Å–≤—è–∑–∏",
                "–û—Å–≤–µ—â–µ–Ω–∏—è",
                "–ú–µ–¥–∏—Ü–∏–Ω—ã"
            ], correct: 1, isCalc: false },
            
            { id: 25, text: "–ß—Ç–æ —Ç–∞–∫–æ–µ –¥–∏—Å–ø–µ—Ä—Å–∏—è –≤ –æ–ø—Ç–æ–≤–æ–ª–æ–∫–Ω–µ?", options: [
                "–†–∞—Å–ø–ª—ã–≤–∞–Ω–∏–µ –∏–º–ø—É–ª—å—Å–∞",
                "–£—Å–∏–ª–µ–Ω–∏–µ —Å–≤–µ—Ç–∞",
                "–û—Ç—Ä–∞–∂–µ–Ω–∏–µ —Å–≤–µ—Ç–∞",
                "–ü–æ–≥–ª–æ—â–µ–Ω–∏–µ —Å–≤–µ—Ç–∞"
            ], correct: 0, isCalc: false },
            
            { id: 26, text: "üßÆ –°–∫–æ—Ä–æ—Å—Ç—å —Å–≤–µ—Ç–∞ –≤ —Å—Ç–µ–∫–ª–µ 200 000 –∫–º/—Å. –ù–∞–π–¥–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å –ø—Ä–µ–ª–æ–º–ª–µ–Ω–∏—è —Å—Ç–µ–∫–ª–∞. (c = 300 000 –∫–º/—Å)", options: [
                "1.33",
                "1.5",
                "1.8",
                "2.0"
            ], correct: 1, isCalc: true, formula: "n = c / v" },
            
            { id: 27, text: "üßÆ –õ—É—á –ø–∞–¥–∞–µ—Ç –∏–∑ –≤–æ–∑–¥—É—Ö–∞ (n=1) –≤ –≤–æ–¥—É (n=1.33) –ø–æ–¥ —É–≥–ª–æ–º 45¬∞. –ù–∞–π–¥–∏ —É–≥–æ–ª –ø—Ä–µ–ª–æ–º–ª–µ–Ω–∏—è. sin45¬∞ = 0.707", options: [
                "28¬∞",
                "32¬∞",
                "38¬∞",
                "42¬∞"
            ], correct: 1, isCalc: true, formula: "n‚ÇÅ¬∑sinŒ± = n‚ÇÇ¬∑sinŒ≤" },
            
            { id: 28, text: "üßÆ –ù–∞–π–¥–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É–≥–æ–ª –¥–ª—è –≥—Ä–∞–Ω–∏—Ü—ã —Å—Ç–µ–∫–ª–æ-–≤–æ–∑–¥—É—Ö. n —Å—Ç–µ–∫–ª–∞ = 1.5", options: [
                "38¬∞",
                "42¬∞",
                "48¬∞",
                "52¬∞"
            ], correct: 1, isCalc: true, formula: "Œ±–∫—Ä = arcsin(n‚ÇÇ / n‚ÇÅ)" },
            
            { id: 29, text: "üßÆ –°–≤–µ—Ç –∏–¥—ë—Ç –∏–∑ –≤–æ–¥—ã (n=1.33) –≤ –∞–ª–º–∞–∑ (n=2.4). –£–≥–æ–ª –ø–∞–¥–µ–Ω–∏—è 50¬∞. –ù–∞–π–¥–∏ —É–≥–æ–ª –ø—Ä–µ–ª–æ–º–ª–µ–Ω–∏—è. sin50¬∞ = 0.766", options: [
                "24¬∞",
                "28¬∞",
                "32¬∞",
                "36¬∞"
            ], correct: 0, isCalc: true, formula: "n‚ÇÅ¬∑sinŒ± = n‚ÇÇ¬∑sinŒ≤" },
            
            { id: 30, text: "üßÆ –°–∏–≥–Ω–∞–ª –∏–¥—ë—Ç –ø–æ –æ–ø—Ç–æ–≤–æ–ª–æ–∫–Ω—É 200 –∫–º. –°–∫–æ—Ä–æ—Å—Ç—å —Å–≤–µ—Ç–∞ –≤ –≤–æ–ª–æ–∫–Ω–µ 200 000 –∫–º/—Å. –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–π–º—ë—Ç –ø–µ—Ä–µ–¥–∞—á–∞?", options: [
                "0.1 –º—Å",
                "1 –º—Å",
                "10 –º—Å",
                "100 –º—Å"
            ], correct: 1, isCalc: true, formula: "t = s / v" }
        ];

        let gameId = null;
        let playerName = '';
        let currentQuestion = 0;
        let answers = {};
        let timerInterval = null;

        window.joinGame = function() {
            const name = document.getElementById('playerName').value.trim();
            const code = document.getElementById('gameCode').value.trim();

            if (!name) return showError('–í–≤–µ–¥–∏ –∏–º—è');
            if (!code || code.length !== 6) return showError('–ö–æ–¥: 6 —Ü–∏—Ñ—Ä');

            playerName = name;
            gameId = `game_${code}`;

            document.getElementById('displayName').innerText = name;
            document.getElementById('displayCode').innerText = code;

            db.ref(`games/${gameId}`).once('value', (snap) => {
                if (!snap.val()) return showError('–ò–≥—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');

                db.ref(`games/${gameId}/players/${name}`).set({
                    name: name,
                    joinedAt: Date.now(),
                    answers: {}
                });

                switchScreen('lobby', 'wait');
                listenToGame();
            });
        };

        function listenToGame() {
            db.ref(`games/${gameId}`).on('value', (snap) => {
                const data = snap.val();
                if (!data) return;

                if (data.players) {
                    document.getElementById('playersCount').innerText = 
                        Object.keys(data.players).length + ' –∏–≥—Ä–æ–∫–æ–≤';
                }

                if (data.status === 'active') {
                    switchScreen('wait', 'game');
                    
                    if (data.players?.[playerName]?.answers) {
                        answers = data.players[playerName].answers;
                    }
                    
                    showQuestion(currentQuestion);
                    updateProgress();
                    
                    if (data.startTime) {
                        startTimer(data.startTime, data.timeLimit || 900);
                    }
                }

                if (data.status === 'finished') {
                    finishGame();
                }
            });
        }

        function switchScreen(from, to) {
            document.getElementById(`screen${from[0].toUpperCase() + from.slice(1)}`).classList.add('hidden');
            document.getElementById(`screen${to[0].toUpperCase() + to.slice(1)}`).classList.remove('hidden');
        }

        function startTimer(startTime, limit) {
            if (timerInterval) clearInterval(timerInterval);
            
            timerInterval = setInterval(() => {
                const remaining = Math.max(0, limit - Math.floor((Date.now() - startTime) / 1000));
                const mins = Math.floor(remaining / 60);
                const secs = remaining % 60;
                document.getElementById('displayTimer').innerText = 
                    `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                if (remaining <= 0) submitTest();
            }, 1000);
        }

        function updateProgress() {
            const answered = Object.keys(answers).length;
            document.getElementById('answeredCount').innerText = `${answered}/30`;
            document.getElementById('progressFill').style.width = (answered / 30 * 100) + '%';
        }

        function showQuestion(index) {
            const q = QUESTIONS[index];
            document.getElementById('questionText').innerText = q.text;
            
            if (q.isCalc) {
                document.getElementById('calcBlock').classList.remove('hidden');
                document.getElementById('formulaDisplay').innerText = q.formula;
            } else {
                document.getElementById('calcBlock').classList.add('hidden');
            }
            
            let optionsHtml = '';
            q.options.forEach((opt, i) => {
                const selected = answers[q.id] === i ? 'selected' : '';
                optionsHtml += `<div class="option ${selected}" onclick="selectAnswer(${q.id}, ${i})">${opt}</div>`;
            });
            document.getElementById('optionsContainer').innerHTML = optionsHtml;
        }

        window.selectAnswer = (qid, opt) => {
            answers[qid] = opt;
            db.ref(`games/${gameId}/players/${playerName}/answers/${qid}`).set(opt);
            
            // –õ–æ–≥ –¥–ª—è —É—á–∏—Ç–µ–ª—è
            db.ref(`games/${gameId}/logs`).push().set({
                name: playerName,
                action: `–æ—Ç–≤–µ—Ç–∏–ª –Ω–∞ –≤–æ–ø—Ä–æ—Å ${qid}`,
                timestamp: Date.now()
            });
            
            updateProgress();
            
            document.querySelectorAll('.option').forEach((el, i) => {
                if (i === opt) el.classList.add('selected');
                else el.classList.remove('selected');
            });
        };

        window.prevQuestion = () => {
            if (currentQuestion > 0) {
                currentQuestion--;
                showQuestion(currentQuestion);
            }
        };

        window.nextQuestion = () => {
            if (currentQuestion < 29) {
                currentQuestion++;
                showQuestion(currentQuestion);
            }
        };

        window.submitTest = function() {
            if (Object.keys(answers).length < 30 && !confirm('–ù–µ –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è. –û—Ç–ø—Ä–∞–≤–∏—Ç—å?')) return;
            
            let correct = 0;
            for (let i = 1; i <= 30; i++) {
                if (answers[i] === QUESTIONS[i-1].correct) correct++;
            }
            const score = Math.round(correct * 3.33);
            
            db.ref(`games/${gameId}/players/${playerName}`).update({
                answers: answers,
                score: score,
                correct: correct,
                submittedAt: Date.now()
            }).then(() => {
                finishGame();
            });
        };

        function finishGame() {
            if (timerInterval) clearInterval(timerInterval);
            db.ref(`games/${gameId}/players/${playerName}`).once('value', (snap) => {
                const player = snap.val();
                switchScreen('game', 'result');
                document.getElementById('finalScore').innerText = (player.score || 0) + ' ‚ú®';
                const correct = player.correct || 0;
                let msg = `–ü—Ä–∞–≤–∏–ª—å–Ω–æ: ${correct}/30`;
                if (correct >= 27) msg += ' ¬∑ –ò–¥–µ–∞–ª—å–Ω–æ!';
                else if (correct >= 24) msg += ' ¬∑ –û—Ç–ª–∏—á–Ω–æ!';
                else if (correct >= 18) msg += ' ¬∑ –•–æ—Ä–æ—à–æ';
                else msg += ' ¬∑ –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë';
                document.getElementById('finalMessage').innerText = msg;
            });
        }

        function showError(msg) {
            document.getElementById('errorMsg').innerText = msg;
        }

        window.exit = () => location.reload();

        document.getElementById('gameCode')?.addEventListener('input', function() {
            this.value = this.value.replace(/\D/g, '').substring(0, 6);
        });
    </script>
</body>
</html>
